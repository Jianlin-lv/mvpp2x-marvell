M:=$(CURDIR)

ifndef KDIR
$(error KDIR is not set. must declare kernel directory. example: export KDIR=~/linux-4.0.4/kernel/)
endif
config := CONFIG_MV_PP2_PALLADIUM


obj-m := mvpp2x.o
mvpp2x-objs := mv_pp2x_ethtool.o mv_pp2x_hw.o mv_pp2x_main.o mv_pp2x_debug.o
mvpp2x-objs += mv_gop110_hw.o
ccflags-y := -I$(M)
ccflags-y += -I${KDIR}/include
ccflags-y += -DMVPP2_DEBUG
ccflags-y += -D$(config)


all:
	make -C ${KDIR} M=$(M) modules


clean:
	make -C ${KDIR} SUBDIRS=$(M) clean


$(info NOTICE: config=$(config))
